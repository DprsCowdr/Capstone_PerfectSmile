<!DOCTYPE html>
<html>
<head>
    <title>Debug Admin Form</title>
</head>
<body>
    <h2>Admin Form Debug</h2>
    
    <form id="testForm">
        <div>
            <label>Date:</label>
            <input type="date" name="date" value="2025-09-20">
        </div>
        <div>
            <label>Branch:</label>
            <select name="branch">
                <option value="">Select Branch</option>
                <option value="1">Main Branch</option>
                <option value="2">Second Branch</option>
            </select>
        </div>
        <div>
            <label>Service:</label>
            <select name="service_id">
                <option value="">Select Service</option>
                <option value="1">Consultation</option>
                <option value="2">Cleaning</option>
            </select>
        </div>
        <div>
            <label>Time:</label>
            <select name="appointment_time">
                <option value="">Loading...</option>
            </select>
        </div>
        <button type="button" onclick="testAvailableSlots()">Test Available Slots</button>
    </form>
    
    <div id="debug-output" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        Debug output will appear here...
    </div>

    <script>
        window.baseUrl = '/Capstone_PerfectSmile/public';
        
        // Test admin selectors
        const ADMIN_SELECTORS = {
            dateInput: 'input[name="date"]',
            branchSelect: 'select[name="branch"]',
            dentistSelect: 'select[name="dentist"]', 
            serviceSelect: 'select[name="service_id"]',
            timeSelect: 'select[name="appointment_time"]'
        };
        
        function log(message) {
            const output = document.getElementById('debug-output');
            output.innerHTML += '<div>' + JSON.stringify(message) + '</div>';
            console.log(message);
        }
        
        function getCsrfToken() {
            // For testing, we'll skip CSRF
            return null;
        }
        
        async function testAvailableSlots() {
            log('=== Testing Available Slots ===');
            
            const dateEl = document.querySelector(ADMIN_SELECTORS.dateInput);
            const branchEl = document.querySelector(ADMIN_SELECTORS.branchSelect);
            const serviceEl = document.querySelector(ADMIN_SELECTORS.serviceSelect);
            
            log('Elements found: ' + JSON.stringify({
                dateEl: !!dateEl,
                branchEl: !!branchEl,
                serviceEl: !!serviceEl
            }));
            
            const date = dateEl ? dateEl.value : '';
            const branchId = branchEl ? branchEl.value : '';
            const serviceId = serviceEl ? serviceEl.value : '';
            
            log('Form values: ' + JSON.stringify({ date, branchId, serviceId }));
            
            if (!date || !branchId || !serviceId) {
                log('Please fill all required fields first');
                return;
            }
            
            const payload = {
                branch_id: branchId,
                date: date,
                service_id: serviceId,
                granularity: 3
            };
            
            log('Payload to send: ' + JSON.stringify(payload));
            
            try {
                const response = await fetch(window.baseUrl + '/appointments/available-slots', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: new URLSearchParams(payload).toString(),
                    credentials: 'same-origin'
                });
                
                const text = await response.text();
                log('Response status: ' + response.status);
                log('Response text: ' + text);
                
                try {
                    const parsed = JSON.parse(text);
                    log('Parsed response: ' + JSON.stringify(parsed));
                } catch (e) {
                    log('Failed to parse response as JSON');
                }
                
            } catch (error) {
                log('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>